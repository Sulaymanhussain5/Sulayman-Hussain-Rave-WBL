<!DOCTYPE html> <!--Using "<!DOCTYPE>" tag  is used to  defines that this is a html documents-->
<html> <!-- Using "<html>" tag is used  for  main tag that starts the html documents-->

<head> <!--Using "<head>" tag is used to add stylesheet which will be supported in styling the header, footer, chatbot and overview of the website. Additionally it also contains the name of the tab of the website-->
    <title>Rave WBL - Sign Up Page</title> <!--Using "<title>" tag is used to define the name of the tab, which will be called "Rave WBL - Login Page"-->
    <meta charset="UTF-8"> <!--Using "<meta>" tag with attribute of "charset" which deals with how should characters should be stored, by using the charset type of "UTF (Unicode Transform Unit)-8" this can store all special sybols and different languages-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!--Using meta tag with attribute of "name" which defines the name of the meta tag which will be "viewpoint" since it deals with making the system responsive to all devices where the "content="width=device-width" makes the webpage fit into all devices, without other elements getting squashed, and "initial-scale=1.0" sets the zoom level which will be 1.0 -->
    <link rel="stylesheet" href="CSS/login.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> 

</head> <!--Close the head tag-->

<body> <!--body tag is used to store all contents within the webpage-->
    <img src="Assets/rave_wbl_logo_v2.png" width="200px" height="200px" alt="Rave WBL Logo" style="display: block; margin: auto;"> <!--Using "<img>" tag to add a Rave WBL Platform Placement logo, with inline style of "display" which is set to block and "margin" which is set to auto these class methods centers the image in center of the page. -->
    <div class="login-container"> <!--Using "<div> to add a login container that contains elements that creates a login form, which uses tag of <h1> (heading), <label> (field names) and <form> (signup form)-->
        <h1 style="text-align: center;">SIGN UP</h1> <!--Using "<h1>" to add the page heading of "SIGN UP"-->
        <div class="checkbox-option"> <!--Using "<div> to add a user type checkbox container that contains eleements that creates a ratio that contains user type of "Student, Staff and Admin"-->
            <label for="studentChoice" style="font-size: 32px;">Student</label><input type="radio" id="studentChoice" style="width: 22px; height: 22px;" name="userType" value="Student"> <!--Using "<label>" to add the checkbot text of "Student" where "<input>" tag is used to insert the ratio (checkbox) of student by using input type of "ratio". It sets the name of input of "userType" to all the input tag which make sure 1 of the checkbox is ticked -->
            <label for="staffChoice" style="font-size: 32px;">Staff</label><input type="radio" id="staffChoice"  style="width: 22px; height: 22px;" name="userType" value="Staff"> <!--Using "<label>" to add the checkbot text of "Staff" where "<input>" tag is used to insert the ratio (checkbox) of staff by using input type of "ratio". It sets the name of input of "userType" to all the input tag which make sure 1 of the checkbox is ticked -->
            <label for="adminChoice" style="font-size: 32px;">Admin</label><input type="radio" id="adminChoice"  style="width: 22px; height: 22px;" name="userType" value="Admin"> <!--Using "<label>" to add the checkbot text of "Admin" where "<input>" tag is used to insert the ratio (checkbox) of admin by using input type of "ratio". It sets the name of input of "userType" to all the input tag which make sure 1 of the checkbox is ticked -->
        </div>  <!--Close the body tag-->
        <br></br>  <!--Add spaces in the page by using <br> tag-->
        <div class="student-login-input"> <!--Using "<div> to add a sign up form that students/staff/admin uses to create a Rave WBL Placement Platform account-->
            <form method="post" action="http://localhost:8080/add-user"> <!--Using "<form>" tag to insert a sign up form where it has a "method" attribute of post which requests to send the form in the back end (local host 8080) sign up data will be integrated in MongoDB database server -->
                <input type="number" placeholder="Enter University ID" name="studentOrStaffId" id="studentOrStaffId"><br></br> <!--Using "<input>" tag to insert the input field for Account ID-->
                <input type="email" placeholder="Enter University Email" name="EmailAddress" id="studentEmailAddress"><br></br> <!--Using "<input>" tag to insert the input field for Email Address-->
                <input type="password" placeholder="Enter University Password" name="Password" id="studentPassword"><br></br> <!--Using "<input>" tag to insert the input field for Password-->
                <button type="submit" onclick="addAccount(event)">SIGN UP</button><br></br> <!--Using "<Button>" tag to insert submittion button where it uses function of "addAccount(event)" which sends the forms to the backend server, this function has been created in "<script>" tag-->
                <a href="0.2_login_page.html">Login If you have an account</a> <!--Using "<a>" tag to insert the link to the login page if students/ staffs or admins already has an account-->
            </form> <!--Close the form tag-->
        </div> <!--Close the div tag-->
    </div> <!--Close the div tag-->
    


<script> //Using "<Script>" tag to insert Javascript within HTML document

    function ToggleUserTypeChoice(){ //Defining function "ToggleTypeChoice" which is used to toggle ratio to each of user type of "Student", "Staff" and "Admin" once it is being selected
            let userType = null //Defining "userType" variable which is set to null. This variable will change once students selects the user type (i.e. if student selects "Student" "userType" variable will automatically set to "Student" by calling it)
            const staffChoice = document.getElementById("staffChoice") //Defining "staffChoice" variable which gets the element by ID which is added in HTML document ("staffChoice")
            const studentChoice = document.getElementById("studentChoice") //Defining "studentChoice" variable which gets the element by ID which is added in HTML document ("studentChoice")
            const adminChoice = document.getElementById("adminChoice") //Defining "adminChoice" variable which gets the element by ID which is added in HTML document ("adminChoice")

            if(studentChoice.checked){ //Using if statement to checked if "Student" has been checked or selected where if use then it will use "userType" variable to change the value to "Student"
                userType = "Student" //Using "userType" variable to change the value to "Student"
                

            }else if(staffChoice.checked){ //Using if statement to checked if "Staff" has been checked or selected where if use then it will use "userType" variable to change the value to "Staff"
                userType = "Staff" //Using "userType" variable to change the value to "Staff"
            }else if(adminChoice){ //Using if statement to checked if "Admin" has been checked or selected where if use then it will use "userType" variable to change the value to "Admin"
                userType = "Admin" //Using "userType" variable to change the value to "Admin"
            }
        }
        document.getElementById("studentChoice").addEventListener('change', ToggleUserTypeChoice) //Using ".addEventListener" which adds an action (event) once "Student" has been selected
        document.getElementById("staffChoice").addEventListener('change', ToggleUserTypeChoice) //Using ".addEventListener" which adds an action (event) once "Staff" has been selected
        document.getElementById("adminChoice").addEventListener('change', ToggleUserTypeChoice) //Using ".addEventListener" which adds an action (event) once "Admin" has been selected






    async function addAccount(event) { //Defining "addAccount" function which has an "event" method added in the parameters which deals with handling actions once submitting the sign up form
        event.preventDefault() //Using ".preventDefault" which is used to prevent the action from happening
        const studentOrStaffId = document.getElementById("studentOrStaffId").value; //Defining "studentOrStaffId" variable that is used to track  value
        const EmailAddress = document.getElementById("studentEmailAddress").value; //Defining "EmailAddress" variable that is used to track  value
        const Password = document.getElementById("studentPassword").value; //Defining "Password" variable that is used to track  value
        const userType = document.querySelector('input[name="userType"]:checked')?.value; //Defining "userType" variable that is used to ratio selection which uses ".querySeector" to select the name of the input tag "userType" and processes if it checked ":chgecked"

        if(studentOrStaffId === ""||EmailAddress==="" || Password==="" || !userType){ //Uses an if statement to check empty fields of "studentOrStaffId", "EmailAddress", "Password" and "userType" where if yes then it will provide a pop up error and prevents from the functrion from moving until field has been filled
            alert("Make sure you have filled all the required field") //Usung "alert" to display a pop message which gives errors to users once form input field has not been filled
            return; //Usung "return" to prevent from task to go to next task until field has been filled
        }else if(studentOrStaffId.length !== 8){ //Uses an else if statement to check if account id is not digit of 8 ( digit Ravensbourne University id number of student or staff ) where if yes then it will provide a pop up error and prevents from the functrion from moving until it is 8 digit
            alert("Your Account ID must be 8 digit long") //Usung "alert" to display a pop message which gives errors to users once form input field has not been filled
            return; //Usung "return" to prevent from task to go to next task until field has been filled
        }else if(!EmailAddress.endsWith("@rave.ac.uk")){ //Uses an else if statement to check if account id is not digit of 8 ( digit Ravensbourne University id number of student or staff ) where if yes then it will provide a pop up error and prevents from the functrion from moving until it is 8 digit
            alert("It should be a university email") //Usung "alert" to display a pop message which gives errors to users once form input field has not been filled
            return; //Usung "return" to prevent from task to go to next task until field has been filled
        }else if(Password.length < 12){ //Uses an else if statement to check if account id is not digit of 8 ( digit Ravensbourne University id number of student or staff ) where if yes then it will provide a pop up error and prevents from the functrion from moving until it is 8 digit
            alert("Password must be at least 12 character long")//Usung "alert" to display a pop message which gives errors to users once form input field has not been filled
            return; //Usung "return" to prevent from task to go to next task until field has been filled
        }
       
        try{ //Using try and catch block which tries to extract the data of job post in the backend, where if there is a problem in backend server then it will jump to catch block where it will provide an error 
            const processUserDetail = await fetch('http://localhost:8080/add-user', { //Defining "processUserDetail" variable to request a post method to backend (fetch) which sends the sign up form with users inputed value 
            method: 'POST', //Using "method" of POST to send the sign up form
            credentials: 'include', //Using "credentials" to add a cookie to the client side which is specifically be used to receiving "jwt" token key
            headers: {'Content-Type':'application/json'}, //Using "headers" to set the content of sending data into "json"
            body: JSON.stringify({studentOrStaffId, EmailAddress, Password, userType:userType}), //Using "body" to convert the requested data of account id (studentOrStaffId), email address, password and user type into json format
        })
        const userDetail = await processUserDetail.json() //Defining "userDetail" variable to convert the response from the server side into json 

        if(processUserDetail.ok){ //Using if statement to check if the  request was successfull, where if use then it will check user type and direct them into different based on what user type user has selected
            if(userType === "Student"){ //Using if statement to check if user has selected "Student" where if yes then it will direct them into student home page
                window.location.href = '1.0_studentPortal_homepage.html' //Using "window.location.href" method to direct students into student home page which is in "1.0_studentPortal_homepage.html" html document
            } else if(userType === "Staff"){ //Using if statement to check if user has selected "Staff" where if yes then it will direct them into staff home page
                window.location.href = '2.0_staffPortal_homepage.html' //Using "window.location.href" method to direct staff into staff home page which is in "2.0_staffPortal_homepage.html" html document
            } else if(userType === "Admin"){ //Using if statement to check if user has selected "Admin" where if yes then it will direct them into admin home page
                window.location.href = '3.0_admin.html' //Using "window.location.href" method to direct admin into admin home page which is in "3.0_admin.html" html document
            }
        }else{ //Using else if to chekc if  request was unsuccessfull where it will provide a pop up error 
            alert("You have already signed up with this account, please log in") //Displaying a pop up error message using "alert"
        }
        } catch(err){ //Using "carch" block to add an error once cleint side has failed to extract data in the database
            console.log(err) //Printing console error
        }
        
    }


    
</script> <!--Close script tag-->

</body> <!--Close body tag-->
</html> <!--Close html tag-->